local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["6"] = 1,["7"] = 1,["8"] = 2,["9"] = 2,["10"] = 3,["11"] = 3,["12"] = 4,["13"] = 4,["14"] = 5,["15"] = 5,["16"] = 6,["17"] = 6,["18"] = 11,["19"] = 11,["20"] = 11,["22"] = 11,["23"] = 18,["24"] = 19,["25"] = 18,["26"] = 27,["27"] = 28,["28"] = 27,["29"] = 36,["30"] = 37,["31"] = 36,["32"] = 44,["33"] = 45,["34"] = 46,["35"] = 44,["36"] = 53,["37"] = 54,["38"] = 53,["39"] = 61,["40"] = 62,["41"] = 61,["42"] = 70,["43"] = 71,["44"] = 70,["45"] = 79,["46"] = 80,["47"] = 79,["48"] = 89,["49"] = 90,["50"] = 90,["51"] = 90,["52"] = 90,["53"] = 90,["54"] = 89,["55"] = 97,["56"] = 98,["57"] = 97,["58"] = 106,["59"] = 107,["60"] = 106,["61"] = 115,["62"] = 116,["63"] = 115,["64"] = 123,["65"] = 124,["66"] = 125,["67"] = 123,["68"] = 132,["69"] = 133,["70"] = 132,["71"] = 141,["72"] = 142,["73"] = 141,["74"] = 150,["75"] = 151,["76"] = 150,["77"] = 160,["78"] = 161,["79"] = 161,["80"] = 161,["81"] = 161,["82"] = 161,["83"] = 160,["84"] = 167,["85"] = 168,["86"] = 167,["87"] = 174,["88"] = 175,["89"] = 174,["90"] = 181,["91"] = 182,["92"] = 183,["94"] = 185,["95"] = 181,["96"] = 193,["97"] = 194,["98"] = 195,["99"] = 196,["101"] = 198,["102"] = 193,["103"] = 204,["104"] = 205,["105"] = 204,["106"] = 214,["107"] = 214,["108"] = 214,["110"] = 215,["111"] = 216,["112"] = 217,["113"] = 218,["114"] = 220,["116"] = 214,["117"] = 229,["118"] = 230,["119"] = 230,["120"] = 230,["121"] = 230,["122"] = 229,["123"] = 236,["124"] = 237,["125"] = 236,["126"] = 245,["127"] = 246,["128"] = 247,["130"] = 249,["131"] = 245,["132"] = 255,["133"] = 256,["134"] = 257,["135"] = 258,["137"] = 260,["138"] = 255,["139"] = 267,["140"] = 268,["141"] = 267,["142"] = 276,["143"] = 277,["144"] = 276,["145"] = 287,["146"] = 287,["147"] = 287,["149"] = 288,["150"] = 289,["151"] = 290,["154"] = 293,["155"] = 294,["156"] = 296,["157"] = 297,["159"] = 300,["160"] = 301,["161"] = 302,["162"] = 303,["163"] = 303,["164"] = 303,["165"] = 303,["166"] = 303,["167"] = 303,["169"] = 305,["172"] = 309,["173"] = 309,["174"] = 309,["175"] = 309,["176"] = 309,["177"] = 309,["178"] = 310,["179"] = 312,["180"] = 287,["181"] = 320,["182"] = 321,["183"] = 320,["184"] = 327,["185"] = 328,["186"] = 327,["187"] = 336,["188"] = 337,["189"] = 338,["191"] = 340,["192"] = 336,["193"] = 348,["194"] = 349,["195"] = 350,["196"] = 351,["198"] = 353,["199"] = 348,["200"] = 362,["201"] = 363,["202"] = 364,["203"] = 365,["204"] = 362,["205"] = 371,["206"] = 372,["207"] = 371,["208"] = 381,["209"] = 382,["210"] = 381,["211"] = 391,["212"] = 392,["213"] = 393,["214"] = 394,["215"] = 391,["216"] = 402,["217"] = 403,["218"] = 404,["219"] = 405,["222"] = 408,["223"] = 409,["224"] = 410,["225"] = 411,["226"] = 412,["227"] = 413,["228"] = 414,["229"] = 415,["230"] = 416,["231"] = 417,["232"] = 418,["233"] = 419,["234"] = 420,["235"] = 421,["236"] = 422,["237"] = 423,["239"] = 402,["240"] = 432,["241"] = 433,["242"] = 434,["243"] = 435,["244"] = 435,["245"] = 435,["246"] = 436,["247"] = 437,["248"] = 435,["249"] = 435,["250"] = 435,["251"] = 435,["252"] = 432,["253"] = 446,["254"] = 447,["255"] = 446,["256"] = 456,["257"] = 457,["258"] = 457,["259"] = 457,["260"] = 457,["261"] = 457,["262"] = 456,["263"] = 465,["264"] = 466,["265"] = 465,["266"] = 475,["267"] = 476,["268"] = 476,["269"] = 476,["270"] = 476,["271"] = 476,["272"] = 475,["273"] = 488,["274"] = 488,["275"] = 488,["277"] = 488,["278"] = 488,["280"] = 488,["281"] = 488,["283"] = 489,["284"] = 489,["285"] = 489,["286"] = 489,["287"] = 489,["288"] = 489,["289"] = 489,["290"] = 488,["291"] = 496,["292"] = 497,["293"] = 498,["295"] = 500,["296"] = 496,["297"] = 506,["298"] = 508,["299"] = 506,["300"] = 516,["301"] = 517,["302"] = 518,["303"] = 520,["304"] = 521,["306"] = 523,["307"] = 525,["308"] = 526,["310"] = 528,["311"] = 530,["312"] = 531,["313"] = 531,["314"] = 531,["315"] = 533,["316"] = 534,["317"] = 535,["318"] = 536,["319"] = 537,["322"] = 531,["323"] = 531,["324"] = 516,["325"] = 550,["326"] = 550,["327"] = 550,["329"] = 551,["330"] = 550,["331"] = 557,["332"] = 558,["333"] = 557,["334"] = 564,["335"] = 565,["336"] = 564,["337"] = 571,["338"] = 572,["339"] = 571,["340"] = 578,["341"] = 579,["342"] = 578,["343"] = 585,["344"] = 585,["345"] = 585,["347"] = 586,["348"] = 587,["349"] = 588,["350"] = 588,["351"] = 588,["352"] = 589,["353"] = 590,["354"] = 588,["355"] = 588,["356"] = 585,["357"] = 598,["358"] = 599,["359"] = 599,["360"] = 599,["361"] = 599,["362"] = 600,["363"] = 600,["364"] = 600,["365"] = 600,["366"] = 598,["367"] = 607,["368"] = 608,["369"] = 609,["371"] = 612,["372"] = 613,["374"] = 615,["375"] = 617,["376"] = 618,["377"] = 619,["379"] = 621,["380"] = 622,["382"] = 624,["383"] = 625,["385"] = 628,["386"] = 629,["388"] = 631,["389"] = 632,["391"] = 634,["392"] = 635,["394"] = 637,["395"] = 638,["397"] = 640,["398"] = 641,["400"] = 643,["401"] = 644,["403"] = 646,["404"] = 647,["406"] = 649,["407"] = 650,["409"] = 652,["410"] = 653,["412"] = 655,["413"] = 656,["416"] = 661,["417"] = 662,["418"] = 663,["420"] = 665,["421"] = 666,["423"] = 668,["424"] = 669,["426"] = 672,["427"] = 673,["429"] = 675,["430"] = 676,["432"] = 678,["433"] = 679,["435"] = 681,["436"] = 682,["438"] = 684,["439"] = 685,["441"] = 687,["442"] = 688,["444"] = 690,["445"] = 691,["447"] = 693,["448"] = 694,["450"] = 696,["451"] = 697,["453"] = 699,["454"] = 700,["457"] = 705,["458"] = 706,["459"] = 707,["460"] = 708,["462"] = 710,["463"] = 711,["465"] = 713,["466"] = 714,["468"] = 716,["469"] = 717,["470"] = 717,["473"] = 721,["474"] = 722,["476"] = 725,["477"] = 607});
local ____exports = {}
local ____BaseUtil = require("solar.solar-common.util.BaseUtil")
local BaseUtil = ____BaseUtil.default
local ____DataBase = require("solar.solar-common.common.DataBase")
local DataBase = ____DataBase.default
local ____MoveType = require("solar.solar-common.constant.MoveType")
local MoveType = ____MoveType.default
local ____AbilityUtil = require("solar.solar-common.util.ability.AbilityUtil")
local AbilityUtil = ____AbilityUtil.default
local ____ObjectDataUtil = require("solar.solar-common.util.object.ObjectDataUtil")
local ObjectDataUtil = ____ObjectDataUtil.default
local ____HeroUtil = require("solar.solar-common.util.unit.HeroUtil")
local HeroUtil = ____HeroUtil.default
____exports.default = __TS__Class()
local UnitStateUtil = ____exports.default
UnitStateUtil.name = "UnitStateUtil"
function UnitStateUtil.prototype.____constructor(self)
end
function UnitStateUtil.getMaxLife(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE)
end
function UnitStateUtil.setMaxLife(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MAX_LIFE, newVal)
end
function UnitStateUtil.addMaxLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_LIFE, addVal)
end
function UnitStateUtil.addMaxLifeAndLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_LIFE, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_LIFE, addVal)
end
function UnitStateUtil.isAlive(self, unitHandle)
    return UnitAlive(unitHandle)
end
function UnitStateUtil.getLife(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_LIFE)
end
function UnitStateUtil.setLife(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_LIFE, newVal)
end
function UnitStateUtil.addLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_LIFE, addVal)
end
function UnitStateUtil.addUnitLifeByMaxLifeP(self, unitHandle, proportion)
    ____exports.default:addUnitState(
        unitHandle,
        UNIT_STATE_LIFE,
        GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE) * proportion
    )
end
function UnitStateUtil.getMaxMana(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MAX_MANA)
end
function UnitStateUtil.setMaxMana(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MAX_MANA, newVal)
end
function UnitStateUtil.addMaxMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_MANA, addVal)
end
function UnitStateUtil.addMaxManaAndMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_MANA, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MANA, addVal)
end
function UnitStateUtil.getMana(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MANA)
end
function UnitStateUtil.setMana(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MANA, newVal)
end
function UnitStateUtil.addMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MANA, addVal)
end
function UnitStateUtil.addUnitManaByMaxManaP(self, unitHandle, proportion)
    ____exports.default:addUnitState(
        unitHandle,
        UNIT_STATE_MANA,
        GetUnitState(unitHandle, UNIT_STATE_MAX_MANA) * proportion
    )
end
function UnitStateUtil.getDamageMax(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageMax)
end
function UnitStateUtil.getDamageBase(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageBase)
end
function UnitStateUtil.setDamageBase(self, unitHandle, newVal)
    if not isBigAttributeMode then
        newVal = math.min(newVal, 2100000000)
    end
    SetUnitState(unitHandle, UnitStateDamageBase, newVal)
end
function UnitStateUtil.addDamageBase(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateDamageBase) + addVal
    if not isBigAttributeMode then
        newVal = math.min(newVal, 2100000000)
    end
    SetUnitState(unitHandle, UnitStateDamageBase, newVal)
end
function UnitStateUtil.getDamageRange(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageRange)
end
function UnitStateUtil.setDamageRange(self, unitHandle, newVal, syncAcquire)
    if syncAcquire == nil then
        syncAcquire = false
    end
    SetUnitState(unitHandle, UnitStateDamageRange, newVal)
    if syncAcquire then
        SetUnitAcquireRange(unitHandle, newVal)
    elseif GetUnitAcquireRange(unitHandle) < newVal then
        SetUnitAcquireRange(unitHandle, newVal)
    end
end
function UnitStateUtil.addDamageRange(self, unitHandle, addVal)
    ____exports.default:setDamageRange(
        unitHandle,
        GetUnitState(unitHandle, UnitStateDamageRange) + addVal
    )
end
function UnitStateUtil.getDamageCool(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageCool)
end
function UnitStateUtil.setDamageCool(self, unitHandle, newVal)
    if newVal < 0.001 then
        newVal = 0.001
    end
    SetUnitState(unitHandle, UnitStateDamageCool, newVal)
end
function UnitStateUtil.addDamageCool(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateDamageCool) + addVal
    if newVal < 0.001 then
        newVal = 0.001
    end
    SetUnitState(unitHandle, UnitStateDamageCool, newVal)
end
function UnitStateUtil.getAttackSpeed(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateAttackSpeed)
end
function UnitStateUtil.setAttackSpeed(self, unitHandle, newVal)
    SetUnitState(unitHandle, UnitStateAttackSpeed, newVal)
end
function UnitStateUtil.setAttackTargetCount(self, unitHandle, targetCount, range, missileart)
    if range == nil then
        range = ____exports.default:getDamageRange(unitHandle) + 200
    end
    local templateId = _sl_funs:borrowTemplate("攻击目标数量辅助")
    if templateId == nil then
        log.errorWithTraceBack("请使用太阳RPG编辑器添加基础物编!")
        return
    end
    _sl_funs:returnTemplate("攻击目标数量辅助", templateId)
    local tempAbilityId = FourCC(templateId)
    if GetUnitAbilityLevel(unitHandle, tempAbilityId) == 0 then
        UnitAddAbility(unitHandle, tempAbilityId)
    end
    if missileart == nil then
        missileart = ObjectDataUtil:getUnitMissileart(id2string(GetUnitTypeId(unitHandle)))
        if missileart ~= nil and #missileart > 3 then
            EXSetAbilityDataString(
                EXGetUnitAbility(unitHandle, tempAbilityId),
                1,
                ABILITY_DATA_MISSILE_ART,
                missileart
            )
        else
            missileart = "Abilities\\Weapons\\Arrow\\ArrowMissile.mdx"
        end
    end
    EXSetAbilityDataString(
        EXGetUnitAbility(unitHandle, tempAbilityId),
        1,
        ABILITY_DATA_MISSILE_ART,
        missileart
    )
    AbilityUtil:setUnitAbilityArea(unitHandle, tempAbilityId, range, false)
    AbilityUtil:setUnitAbilityDataC(unitHandle, tempAbilityId, targetCount, true)
end
function UnitStateUtil.addAttackSpeed(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UnitStateAttackSpeed, addVal)
end
function UnitStateUtil.getArmor(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateArmor)
end
function UnitStateUtil.setArmor(self, unitHandle, newVal)
    if not isBigAttributeMode then
        newVal = math.min(newVal, 2100000000)
    end
    SetUnitState(unitHandle, UnitStateArmor, newVal)
end
function UnitStateUtil.addArmor(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateArmor) + addVal
    if not isBigAttributeMode then
        newVal = math.min(newVal, 2100000000)
    end
    SetUnitState(unitHandle, UnitStateArmor, newVal)
end
function UnitStateUtil.addUnitState(self, unitHandle, whichUnitState, addVal)
    local newVal = GetUnitState(unitHandle, whichUnitState) + addVal
    SetUnitState(unitHandle, whichUnitState, newVal)
    return newVal
end
function UnitStateUtil.getMoveSpeed(self, unitHandle)
    return GetUnitMoveSpeed(unitHandle)
end
function UnitStateUtil.setMoveSpeed(self, unitHandle, newSpeed)
    SetUnitMoveSpeed(unitHandle, newSpeed)
end
function UnitStateUtil.addMoveSpeed(self, unitHandle, addSpeed)
    local newVal = GetUnitMoveSpeed(unitHandle) + addSpeed
    SetUnitMoveSpeed(unitHandle, newVal)
    return newVal
end
function UnitStateUtil.setMoveType(self, unitHandle, moveType)
    local moveTypeElement = MoveType[moveType]
    EXSetUnitMoveType(unitHandle, moveTypeElement)
    if SetUnitMoveType == nil then
        return
    end
    if moveTypeElement == 0 then
        SetUnitMoveType(unitHandle, "none")
    elseif moveTypeElement == 1 then
        SetUnitMoveType(unitHandle, "nomove")
    elseif moveTypeElement == 2 then
        SetUnitMoveType(unitHandle, "foot")
    elseif moveTypeElement == 4 then
        SetUnitMoveType(unitHandle, "fly")
    elseif moveTypeElement == 64 then
        SetUnitMoveType(unitHandle, "float")
    elseif moveTypeElement == 8 then
        SetUnitMoveType(unitHandle, "hover")
    elseif moveTypeElement == 128 then
        SetUnitMoveType(unitHandle, "amph")
    elseif moveTypeElement == 32 then
        SetUnitMoveType(unitHandle, "unbuild")
    end
end
function UnitStateUtil.setUnitFacing(self, unit, face)
    local x = GetUnitX(unit)
    local y = GetUnitY(unit)
    BaseUtil.runLater(
        0.01,
        function()
            SetUnitPosition(unit, x, y)
            EXSetUnitFacing(unit, face)
        end,
        3,
        true
    )
end
function UnitStateUtil.getUnitLifeP(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_LIFE) / GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE)
end
function UnitStateUtil.setUnitLifeP(self, unitHandle, proportion)
    return SetUnitState(
        unitHandle,
        UNIT_STATE_LIFE,
        GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE) * proportion
    )
end
function UnitStateUtil.getUnitManaP(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MANA) / GetUnitState(unitHandle, UNIT_STATE_MAX_MANA)
end
function UnitStateUtil.setUnitManaP(self, unitHandle, proportion)
    return SetUnitState(
        unitHandle,
        UNIT_STATE_MANA,
        GetUnitState(unitHandle, UNIT_STATE_MAX_MANA) * proportion
    )
end
function UnitStateUtil.setUnitColor(self, whichUnit, red, green, blue, alpha)
    if green == nil then
        green = red
    end
    if blue == nil then
        blue = green
    end
    if alpha == nil then
        alpha = 255
    end
    SetUnitVertexColor(
        whichUnit,
        red,
        green,
        blue,
        alpha
    )
end
function UnitStateUtil.isInvulnerable(self, unitHandle)
    if GetUnitAbilityLevel(unitHandle, "Avul") > 0 then
        return true
    end
    return false
end
function UnitStateUtil.setInvulnerable(self, unitHandle, isInvulnerable)
    SetUnitInvulnerable(unitHandle, isInvulnerable)
end
function UnitStateUtil.addInvulnerableIfNot(self, unitHandle, dur)
    local unitSolarData = DataBase:getUnitSolarData(unitHandle, true)
    local invulnerable_endTime = unitSolarData.invulnerable_endTime
    if GetUnitAbilityLevel(unitHandle, "Avul") > 0 and invulnerable_endTime == nil then
        return false
    end
    local newInvulnerable_endTime = _g_time + math.floor(dur * 100) * 10
    if invulnerable_endTime and invulnerable_endTime >= newInvulnerable_endTime then
        return false
    end
    unitSolarData.invulnerable_endTime = newInvulnerable_endTime
    SetUnitInvulnerable(unitHandle, true)
    BaseUtil.runLater(
        dur,
        function()
            local solarDataTemp = DataBase:getUnitSolarData(unitHandle, false)
            if (solarDataTemp and solarDataTemp.invulnerable_endTime) == nil or _g_time >= solarDataTemp.invulnerable_endTime then
                SetUnitInvulnerable(unitHandle, false)
                if solarDataTemp then
                    solarDataTemp.invulnerable_endTime = nil
                end
            end
        end
    )
end
function UnitStateUtil.applyTimedLife(self, unitHandle, duration, buffid)
    if buffid == nil then
        buffid = "BHwe"
    end
    UnitApplyTimedLife(unitHandle, buffid, duration)
end
function UnitStateUtil.orderPatrol(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "patrol", x, y)
end
function UnitStateUtil.orderAttack(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "attack", x, y)
end
function UnitStateUtil.orderAttackTarget(self, unitHandle, target)
    IssueTargetOrder(unitHandle, "attack", target)
end
function UnitStateUtil.orderMove(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "move", x, y)
end
function UnitStateUtil.stunUnit(self, unitHandle, dur, effectPath)
    if effectPath == nil then
        effectPath = "Abilities\\Spells\\Human\\Thunderclap\\ThunderclapTarget.mdx"
    end
    EXPauseUnit(unitHandle, true)
    local effect = AddSpecialEffectTarget(effectPath, unitHandle, "head")
    BaseUtil.runLater(
        dur,
        function()
            EXPauseUnit(unitHandle, false)
            DestroyEffect(effect)
        end
    )
end
function UnitStateUtil.enableFlyHeight(self, unitHandle)
    UnitAddAbility(
        unitHandle,
        FourCC("Amrf")
    )
    UnitRemoveAbility(
        unitHandle,
        FourCC("Amrf")
    )
end
function UnitStateUtil.calculateStateFormula(self, formula, srcUnit, targetUnit)
    if formula == nil then
        return 0
    end
    if formula.chance ~= nil and GetRandomReal(0, 1) > formula.chance then
        return 0
    end
    local value = formula.base or 0
    if srcUnit ~= nil then
        if formula.attack then
            value = value + GetUnitState(srcUnit, UnitStateDamageMax) * formula.attack
        end
        if formula.def then
            value = value + GetUnitState(srcUnit, UnitStateArmor) * formula.def
        end
        if formula.fullPros then
            value = value + (GetHeroStr(srcUnit, true) + GetHeroAgi(srcUnit, true) + GetHeroInt(srcUnit, true)) * formula.fullPros
        end
        if formula.primaryPros then
            value = value + HeroUtil:getHeroPrimaryValue(srcUnit, true) * formula.primaryPros
        end
        if formula.str then
            value = value + GetHeroStr(srcUnit, true) * formula.str
        end
        if formula.agi then
            value = value + GetHeroAgi(srcUnit, true) * formula.agi
        end
        if formula.int then
            value = value + GetHeroInt(srcUnit, true) * formula.int
        end
        if formula.hp then
            value = value + GetUnitState(srcUnit, UNIT_STATE_LIFE) * formula.hp
        end
        if formula.mana then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MANA) * formula.mana
        end
        if formula.maxHp then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MAX_LIFE) * formula.maxHp
        end
        if formula.maxMana then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MAX_MANA) * formula.maxMana
        end
        if formula.loseHp then
            value = value + (GetUnitState(srcUnit, UNIT_STATE_MAX_LIFE) - GetUnitState(srcUnit, UNIT_STATE_LIFE)) * formula.loseHp
        end
        if formula.loseMana then
            value = value + (GetUnitState(srcUnit, UNIT_STATE_MAX_MANA) - GetUnitState(srcUnit, UNIT_STATE_MANA)) * formula.loseMana
        end
    end
    if targetUnit ~= nil then
        if formula.target_attack then
            value = value + GetUnitState(targetUnit, UnitStateDamageMax) * formula.target_attack
        end
        if formula.target_def then
            value = value + GetUnitState(targetUnit, UnitStateArmor) * formula.target_def
        end
        if formula.target_fullPros then
            value = value + (GetHeroStr(targetUnit, true) + GetHeroAgi(targetUnit, true) + GetHeroInt(targetUnit, true)) * formula.target_fullPros
        end
        if formula.target_primaryPros then
            value = value + HeroUtil:getHeroPrimaryValue(targetUnit, true) * formula.target_primaryPros
        end
        if formula.target_str then
            value = value + GetHeroStr(targetUnit, true) * formula.target_str
        end
        if formula.target_agi then
            value = value + GetHeroAgi(targetUnit, true) * formula.target_agi
        end
        if formula.target_int then
            value = value + GetHeroInt(targetUnit, true) * formula.target_int
        end
        if formula.target_hp then
            value = value + GetUnitState(targetUnit, UNIT_STATE_LIFE) * formula.target_hp
        end
        if formula.target_mana then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MANA) * formula.target_mana
        end
        if formula.target_maxHp then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE) * formula.target_maxHp
        end
        if formula.target_maxMana then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MAX_MANA) * formula.target_maxMana
        end
        if formula.target_loseHp then
            value = value + (GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE) - GetUnitState(targetUnit, UNIT_STATE_LIFE)) * formula.target_loseHp
        end
        if formula.target_loseMana then
            value = value + (GetUnitState(targetUnit, UNIT_STATE_MAX_MANA) - GetUnitState(targetUnit, UNIT_STATE_MANA)) * formula.target_loseMana
        end
    end
    local player = GetOwningPlayer(srcUnit)
    if IsHandle(player) then
        if formula.gold then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_GOLD) * formula.gold
        end
        if formula.lumber then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_LUMBER) * formula.lumber
        end
        if formula.food then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_FOOD_USED) * formula.food
        end
        if formula.kills then
            local ____opt_2 = DataBase:getPlayerSolarData(player, false)
            value = value + (____opt_2 and ____opt_2.killCount or 0) * formula.kills
        end
    end
    if formula.increased then
        value = value * (1 + formula.increased)
    end
    return value
end
return ____exports
